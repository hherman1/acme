#!/bin/bash
# runs the given command but pipes output to page
#cd $1
#"${@:2}" 2>&1 | page

ID=$(acmectl new)
WD=$(pwd)"/"
acmectl ctl $ID name $WD
acmectl ctl $ID nomenu
printf Kill | acmectl write $ID tag


FIFO=inpage_cmd_fifo
rm -f $FIFO
mkfifo $FIFO
"${@:2}" 2>&1 > $FIFO &
EXE_PID=$!
acmectl write $ID data < $FIFO &
WRITE_PID=$!
acmectl onexec $ID Kill "kill -9 $EXE_PID" &
CTL_PID=$!
wait $EXE_PID $WRITE_PID

acmectl ctl $ID clean;
# cleanup now that paging is complete;
printf 0,0 | acmectl write $ID addr;
acmectl ctl $ID dot=addr;
acmectl ctl $ID show;
